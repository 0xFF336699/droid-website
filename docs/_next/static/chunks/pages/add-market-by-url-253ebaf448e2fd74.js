(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[436],{93896:(t,e,n)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/add-market-by-url",function(){return n(23311)}])},23311:(t,e,n)=>{"use strict";n.r(e),n.d(e,{default:()=>k});var r=n(50612),i=n(75936),o=n(73256),l=n(25065),a=n(40242),s=n(94344),c=n(86035),d=n(3072),u=n(65820),h=n(12066),m=n(13124),f=n(88171),x=n(57988),p=n(41878),y=n(76528),g=n(64901),v=n(22467);async function w(t){let e="https://autumn-mouse-8da2.mailregios.workers.dev/?url=".concat(encodeURIComponent(t)),n=await v.A.get(e);if(!n.data||!n.data.html)throw Error("Failed to fetch HTML content.");let{origin:r}=new URL(t),i=n.data.html;function o(t,e){let n;n=t.endsWith("/")&&e.startsWith("/")?t+e.slice(1):t.endsWith("/")||e.startsWith("/")?t+e:t+"/"+e;let r="__time__=".concat(Date.now());return n.includes("?")?/([&?])__time__=/.test(n)?n:n+(n.endsWith("?")||n.endsWith("&")?"":"&")+r:n+"?"+r}return console.log("parsed html=",i=(i=(i=i.replace(/(<script[^>]*src=["'])(?!https?:|\/\/)([^"'>]+)/gi,(t,e,n)=>"".concat(e).concat(o(r,n)))).replace(/(<link[^>]*href=["'])(?!https?:|\/\/)([^"'>]+)/gi,(t,e,n)=>"".concat(e).concat(o(r,n)))).replace(/(@import\s+["'])(?!https?:|\/\/)([^"']+)/gi,(t,e,n)=>"".concat(e).concat(o(r,n)))),i}let b=t=>{let{isFullMarketPage:e,onMarketConfigReady:n,initialValue:i="",initialIsUrl:o=!0}=t,[l,c]=(0,s.useState)(i),[d,u]=(0,s.useState)(o),[m,x]=(0,s.useState)(""),{t:v}=(0,a.useTranslation)("homepage/components/page/add-market-by-url/ui/market-input-form/content"),b=t=>{try{return new URL(t),!0}catch(t){return!1}},j=(0,s.useCallback)(async(t,e)=>{if(console.log("Processing input:",t,"Is URL:",e),!t){x(""),n({str:"",isUrl:d}),console.log("cleared");return}if(e){if(t&&b(t)){let e=await w(t);e?(x(""),n({str:e,isUrl:!1})):x("Failed to fetch HTML content.")}else t?x("Please enter a valid URL."):x("")}else x(""),n({str:t,isUrl:!1})},[n]),{run:k}=(0,g.A)(j,{wait:500}),A="";A=v(d?e?"content.full.url":"content.item.url":e?"content.full.html":"content.item.html");let C="";return C=d?e?"https://github.com/your-name/your-repo/docs/market.html":"https://github.com/your-name/your-repo/docs/summary.html":e?"<html><body><div>script list<div></body></html>":"<html><body><div>".concat(v("content.item.come"),'<a href="https://github.com/your-name/your-repo/docs/index.html">').concat(v("content.item.myMarketName"),"</a>").concat(v("content.item.stroll"),"</div></body></html>"),(0,r.jsxs)(h.A,{sx:{display:"flex",flexDirection:"column",gap:2},children:[(0,r.jsx)(f.A,{label:A,variant:"outlined",fullWidth:!0,value:l,onChange:t=>{let e=t.target.value;c(e),k(e,d)},error:!!m,helperText:m,placeholder:C,multiline:!d,rows:d?1:4}),(0,r.jsx)(y.A,{control:(0,r.jsx)(p.A,{checked:d,onChange:t=>{let e=t.target.checked;u(e),j(l,e)}}),label:v("content.isUrl")})]})},j=()=>{let[t,e]=(0,s.useState)(""),[n,i]=(0,s.useState)(""),[o,l]=(0,s.useState)(""),[p,y]=(0,s.useState)(null),[g,v]=(0,s.useState)(null),{t:w}=(0,a.useTranslation)("homepage/components/page/add-market-by-url/ui/content"),j={minWidth:"300px",minHeight:"200px",border:"1px solid #ccc",display:"block"},k=(0,s.useCallback)(t=>{y(t)},[]),A=(0,s.useCallback)(t=>{v(t)},[]);return(0,r.jsx)(c.A,{sx:{maxWidth:800,margin:"auto",mt:2},children:(0,r.jsxs)(d.A,{children:[(0,r.jsx)(h.A,{sx:{mb:2,color:"error.main"},children:w("content.warning")}),(0,r.jsx)(u.A,{variant:"h5",component:"h2",gutterBottom:!0,children:w("content.setNewMarket")}),(0,r.jsxs)(h.A,{sx:{mb:2},children:[(0,r.jsx)(f.A,{fullWidth:!0,label:w("content.marketName"),variant:"outlined",value:t,onChange:t=>e(t.target.value),sx:{mb:1}}),(0,r.jsx)(f.A,{fullWidth:!0,label:w("content.marketSummary"),variant:"outlined",value:n,onChange:t=>i(t.target.value),multiline:!0,rows:2,sx:{mb:1}}),(0,r.jsx)(f.A,{fullWidth:!0,label:w("content.marketDescription"),variant:"outlined",value:o,onChange:t=>l(t.target.value),multiline:!0,rows:4,sx:{mb:2}})]}),(0,r.jsx)(u.A,{variant:"h6",gutterBottom:!0,sx:{mt:2},children:w("content.itemMarket")}),(0,r.jsx)(b,{onMarketConfigReady:k,isFullMarketPage:!1}),(0,r.jsx)(u.A,{variant:"h6",gutterBottom:!0,sx:{mt:2},children:w("content.fullMarket")}),(0,r.jsx)(b,{onMarketConfigReady:A,isFullMarketPage:!0}),(0,r.jsx)(m.A,{sx:{my:2}}),(t||n||o||p||g)&&(0,r.jsxs)(h.A,{children:[(0,r.jsx)("hr",{}),(0,r.jsx)(u.A,{sx:{textAlign:"center"},variant:"h6",component:"h3",gutterBottom:!0,children:w("content.settingPreview")}),(0,r.jsxs)(u.A,{variant:"body1",component:"p",paragraph:!0,children:[(0,r.jsxs)("strong",{children:[w("content.marketName"),":"]})," ",t||w("content.isNotSet")]}),(0,r.jsxs)(u.A,{variant:"body1",component:"p",paragraph:!0,children:[(0,r.jsxs)("strong",{children:[w("content.marketSummary"),":"]})," ",n||w("content.isNotSet")]}),(0,r.jsxs)(u.A,{variant:"body1",component:"p",paragraph:!0,children:[(0,r.jsxs)("strong",{children:[w("content.marketDescription"),":"]})," ",o||w("content.isNotSet")]}),p&&(0,r.jsxs)(h.A,{sx:{mb:2},children:[(0,r.jsx)(u.A,{variant:"subtitle1",gutterBottom:!0,children:w("content.marketCardPreview")}),(0,r.jsx)(x.T,{url:p.isUrl?p.str:void 0,content:p.isUrl?void 0:p.str,style:j},"item-market-".concat(p.str))]}),g&&(0,r.jsxs)(h.A,{children:[(0,r.jsx)(u.A,{variant:"subtitle1",gutterBottom:!0,children:w("content.marketFullPreview")}),(0,r.jsx)(x.T,{url:g.isUrl?g.str:void 0,content:g.isUrl?void 0:g.str,style:j},"full-market-".concat(g.str))]})]})]})})};function k(){let t=new l.m,{t:e}=(0,a.useTranslation)("homepage/pages/add-market-by-url/content");return(0,r.jsxs)(i.G,{children:[(0,r.jsx)(o.W,{appbarProps:{title:e("content.title"),back:!0,backDispatcher:t}}),(0,r.jsx)(j,{})]})}},75936:(t,e,n)=>{"use strict";n.d(e,{G:()=>h});var r=n(50612),i=n(40242),o=n(68053),l=n(23026),a=n(42590),s=n(57555),c=n(53757),d=n(94344),u=n(26954);function h(t){let{children:e}=t,n=(0,c.useRouter)(),h="scrollPositionInfo",m=window.location.href.split("#")[0],f="dynamic-".concat(m),x=o.P.namespace(f),p=x.read(f);return p||(p={}),p=(0,l.I$)(p),(0,d.useEffect)(()=>{n.beforePopState(t=>(x.clearAll(),!0))}),(0,d.useEffect)(()=>(x.write(f,p),(0,a.c)(p,()=>{x.write(f,p)})),[]),(0,d.useEffect)(()=>{let t=x.read(h)||{x:0,y:0};function e(t){x.write(h,{x:window.scrollX,y:window.scrollY})}function n(){window.addEventListener("scroll",e)}return 0==t.x&&0==t.y?n():window.requestAnimationFrame(()=>{window.scrollTo(t.x,t.y),n()}),function(){window.removeEventListener("scroll",e)}}),(0,r.jsx)(s.q,{value:x,children:(0,r.jsx)(s.p,{value:p,children:(0,r.jsx)(u.xC,{i18n:i.i18n,children:e})})})}(0,i.i18nInit)()},73256:(t,e,n)=>{"use strict";n.d(e,{W:()=>F});var r=n(50612),i=n(35011),o=n(80686),l=n(9655),a=n(67779),s=n(16425),c=n(23235),d=n(92776),u=n(64909),h=n(61150),m=n(88778),f=n(62754),x=n(28542),p=n(94344),y=n(53757),g=n(25065),v=(t,e,n)=>new Promise((r,i)=>{var o=t=>{try{a(n.next(t))}catch(t){i(t)}},l=t=>{try{a(n.throw(t))}catch(t){i(t)}},a=t=>t.done?r(t.value):Promise.resolve(t.value).then(o,l);a((n=n.apply(t,e)).next())});let w=new g.m,b={dipsatcher:w,screenLockCount:0,switchPage:()=>v(void 0,null,function*(){w.dispatch("switchPage"),b.screenLockCount=0}),listenSwitchPage:t=>w.addListener("switchPage",t)};var j=n(76838),k=n(2196);function A(t){let{children:e}=t,n=(0,y.useRouter)();return(0,r.jsx)(j.N,{mode:"wait",children:(0,r.jsx)(k.P.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},transition:{duration:.3},children:e},n.route)})}let C=0;function E(t){let{children:e}=t,n="app-shell-".concat(C++);return(0,p.useEffect)(()=>{let t=document.querySelector("#".concat(n)),e=b.listenSwitchPage(()=>{if(!t)return});if(t)return t.addEventListener("click",t=>{0!=b.screenLockCount&&(t.stopPropagation(),t.preventDefault())}),()=>{e()}},[]),(0,r.jsx)(a.A,{id:n,children:(0,r.jsx)(A,{children:e})})}var P=n(22726),L=Object.defineProperty,M=Object.defineProperties,W=Object.getOwnPropertyDescriptors,S=Object.getOwnPropertySymbols,I=Object.prototype.hasOwnProperty,R=Object.prototype.propertyIsEnumerable,_=(t,e,n)=>e in t?L(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,U=(t,e)=>{for(var n in e||(e={}))I.call(e,n)&&_(t,n,e[n]);if(S)for(var n of S(e))R.call(e,n)&&_(t,n,e[n]);return t},z=(t,e)=>M(t,W(e));function H(t){let{children:e,window:n}=t,l=(0,i.A)({target:n?n():void 0});return(0,r.jsx)(o.A,{appear:!1,direction:"down",in:!l,children:null!=e?e:(0,r.jsx)("div",{})})}function T(t){let{children:e,window:n}=t,o=(0,i.A)({target:n?n():void 0,disableHysteresis:!0,threshold:100});return(0,r.jsx)(l.A,{in:o,children:(0,r.jsx)(a.A,{"data-id":"content-scroll-top-button",onClick:t=>{let e=(t.target.ownerDocument||document).querySelector("#back-to-top-anchor");e&&e.scrollIntoView({block:"center"})},role:"presentation",sx:{position:"fixed",bottom:16,right:16},children:e})})}function F(t){let{children:e,appbarProps:n,titleConf:i}=t,o=(0,y.useRouter)();return(0,r.jsx)(E,{children:(0,r.jsxs)(p.Fragment,{children:[(0,r.jsx)(s.Ay,{}),(0,r.jsx)(H,z(U({},t),{children:(0,r.jsx)(c.A,{color:"inherit",children:(0,r.jsxs)(d.A,{children:[(0,r.jsx)(f.A,{onClick:function(){if(!m.W.askHistoryBack().defaultPrevented){if(n.backDispatcher){let t={defaultPrevented:!1};if(n.backDispatcher.dispatch("back",t),t.defaultPrevented)return}o.back()}}}),n.title]})})})),(0,r.jsx)(d.A,{id:"back-to-top-anchor"}),(0,r.jsx)(u.A,{sx:{padding:"0",marginTop:"17px"},children:(0,r.jsx)(P.A,{titleConf:i,children:e})}),(0,r.jsx)(T,z(U({},t),{children:(0,r.jsx)(h.A,{size:"small","aria-label":"scroll back to top",children:(0,r.jsx)(x.A,{})})}))]})})}},22726:(t,e,n)=>{"use strict";n.d(e,{A:()=>x});var r=n(50612),i=n(67779),o=n(85364),l=n(64909),a=n(94344),s=n(77570),c=n(40242),d=(t,e,n)=>new Promise((r,i)=>{var o=t=>{try{a(n.next(t))}catch(t){i(t)}},l=t=>{try{a(n.throw(t))}catch(t){i(t)}},a=t=>t.done?r(t.value):Promise.resolve(t.value).then(o,l);a((n=n.apply(t,e)).next())});function u(){return s.Cu?(0,r.jsxs)(i.A,{children:[(0,r.jsx)(o.A,{onClick:()=>{window.location.reload()},children:"reload"}),new Date().toLocaleString()]}):(0,r.jsx)(r.Fragment,{children:"  "})}let h=(0,a.createContext)({x:0,y:0}),m=0;function f(t){let{children:e,titleConf:n}=t;m++;let o=(0,a.useContext)(h),s="".concat(Date.now()+Math.random()*Date.now());return(0,a.useEffect)(()=>{!function(){d(this,null,function*(){if(!n)return;let t=n.title;n.ns&&(t=yield(0,c.loadI18nValue)(n.ns,n.key||"content.title")),t&&(document.title=t)})}()},[]),(0,a.useEffect)(()=>{let t=document.getElementsByClassName(s)[0];if(!t)return;t.scrollTop=o.y;let e=()=>{var e=t.scrollTop;o.y=e};return t.removeEventListener("scroll",e),t.addEventListener("scroll",e,{passive:!0}),()=>t.removeEventListener("scroll",e)},[s,o]),(0,r.jsx)(l.A,{className:s,sx:{flexGrow:1,overflow:"auto",padding:"0px"},children:(0,r.jsxs)(i.A,{children:[(0,r.jsx)(u,{}),e]})})}function x(t){let{children:e,titleConf:n}=t;return(0,r.jsx)(f,{titleConf:n,children:e})}},57988:(t,e,n)=>{"use strict";n.d(e,{T:()=>m});var r=n(50612),i=n(94344),o=n(22467),l=(t,e,n)=>new Promise((r,i)=>{var o=t=>{try{a(n.next(t))}catch(t){i(t)}},l=t=>{try{a(n.throw(t))}catch(t){i(t)}},a=t=>t.done?r(t.value):Promise.resolve(t.value).then(o,l);a((n=n.apply(t,e)).next())});class a{loadContent(t){this.currentLoadCallback=null,this.currentErrorCallback=null;let e="\n            <script>\n                const IFRAME_ID = '".concat(this.iframeId,"';\n                function notifyResize() {\n                    const body = document.body;\n                    const html = document.documentElement;\n                    \n                    // 获取实际内容高度（取最大值）\n                    const height = Math.max(\n                        body.scrollHeight,\n                        body.offsetHeight,\n                        html.clientHeight,\n                        html.scrollHeight,\n                        html.offsetHeight\n                    );\n                    \n                    // 获取实际内容宽度（取最大值）\n                    const width = Math.max(\n                        body.scrollWidth,\n                        body.offsetWidth,\n                        html.clientWidth,\n                        html.scrollWidth,\n                        html.offsetWidth\n                    );\n                    \n                    window.parent.postMessage({ \n                        type: 'resize', \n                        height, \n                        width,\n                        iframeId: IFRAME_ID \n                    }, '*');\n                }\n                \n                // 监听DOM变化\n                const observer = new MutationObserver(() => {\n                    requestAnimationFrame(notifyResize);\n                });\n                \n                observer.observe(document.body, { \n                    childList: true, \n                    subtree: true, \n                    attributes: true \n                });\n                \n                // 监听图片加载完成\n                document.addEventListener('load', function(e) {\n                    if (e.target.tagName === 'IMG') {\n                        notifyResize();\n                    }\n                }, true);\n                \n                // 监听窗口大小变化\n                window.addEventListener('resize', notifyResize);\n                \n                // 初始化时多次检查大小\n                window.addEventListener('load', () => {\n                    notifyResize();\n                    // 延迟再次检查，处理动态内容\n                    setTimeout(notifyResize, 100);\n                    setTimeout(notifyResize, 500);\n                });\n                \n                // 立即执行一次\n                notifyResize();\n            <\/script>\n        "),n=t.includes("</body>")?t.replace("</body>","".concat(e,"</body>")):"".concat(t).concat(e);this.iframe.srcdoc=n}setMinSize(t,e){this.minWidth=t,this.minHeight=e}setMaxSize(t,e){this.maxWidth=t,this.maxHeight=e}handleIframeMessage(t){if("resize"===t.data.type&&t.data.iframeId===this.iframeId){let{height:e,width:n}=t.data,r=window.innerWidth;null!==this.minWidth&&(n=Math.max(n,this.minWidth)),null!==this.minHeight&&(e=Math.max(e,this.minHeight)),n=null!==this.maxWidth?Math.min(n,this.maxWidth):Math.min(n,r),null!==this.maxHeight&&(e=Math.min(e,this.maxHeight)),this.container.style.height="".concat(e,"px"),this.container.style.width="".concat(n,"px")}}loadUrl(t,e,n){return l(this,null,function*(){this.currentLoadCallback=e||null,this.currentErrorCallback=n||null,this.iframe?this.iframe.src=t:console.error("IFrameContainer: iframe element is null in loadUrl!")})}testUrl(t){return l(this,null,function*(){try{let e=yield o.A.get(t);console.log("res=",e)}catch(t){console.error("test load url error",t)}})}loadUrlAsContent(t){return l(this,null,function*(){console.log("laodUrlAsContent_fn",t);try{let e=yield fetch(t);if(!e.ok)throw Error("HTTP error! status: ".concat(e.status));let n=yield e.text();this.loadContent(n)}catch(t){throw console.error("Failed to load URL content:",t),t}})}getContainer(){return this.container}setSize(t,e){this.container.style.width=t,this.container.style.height=e}constructor(){this.minWidth=null,this.minHeight=null,this.maxWidth=null,this.maxHeight=null,this.currentLoadCallback=null,this.currentErrorCallback=null,this.iframeId="iframe_"+Math.random().toString(36).substr(2,9),this.container=document.createElement("div"),this.iframe=document.createElement("iframe"),this.container.style.width="100%",this.container.style.height="100%",this.container.style.overflow="hidden",this.container.style.position="relative",this.container.style.maxWidth="100%",this.container.style.margin="0 auto",this.iframe.style.width="100%",this.iframe.style.height="100%",this.iframe.style.border="none",this.iframe.style.overflow="hidden",this.iframe.setAttribute("scrolling","no"),this.iframe.setAttribute("seamless","seamless"),this.iframe.onload=()=>{this.currentLoadCallback&&this.currentLoadCallback(),(0,window.iframeResize)({onReady:t=>{},license:"GPLv3",waitForLoad:!0,log:!1,checkOrigin:!1},"#".concat(this.iframeId))},this.iframe.onerror=(t,e,n,r,i)=>{console.error('%cIFrameContainer: iframe "error" event triggered.',"color: red; font-weight: bold;",t);let o=i||Error("string"==typeof t?t:"Failed to load iframe content");this.currentErrorCallback&&this.currentErrorCallback(o)},this.container.appendChild(this.iframe),this.iframe.id=this.iframeId,window.addEventListener("message",this.handleIframeMessage.bind(this))}}var s=n(12066),c=n(76806),d=n(65820),u=n(10216),h=(t,e,n)=>new Promise((r,i)=>{var o=t=>{try{a(n.next(t))}catch(t){i(t)}},l=t=>{try{a(n.throw(t))}catch(t){i(t)}},a=t=>t.done?r(t.value):Promise.resolve(t.value).then(o,l);a((n=n.apply(t,e)).next())});let m=t=>{let{style:e,className:n,url:o,content:l,minWidth:m,minHeight:f,maxWidth:x,maxHeight:p,onError:y,onLoad:g}=t,v=(0,i.useRef)(null),w=(0,i.useRef)(null),[b,j]=(0,i.useState)(!1),[k,A]=(0,i.useState)(null);return(0,i.useEffect)(()=>{if(!w.current&&v.current){w.current=new a;let t=w.current;t.setMinSize(null!=m?m:null,null!=f?f:null),t.setMaxSize(null!=x?x:null,null!=p?p:null),v.current.appendChild(t.getContainer())}return()=>{v.current&&w.current&&(v.current.removeChild(w.current.getContainer()),w.current=null)}},[m,f,x,p]),(0,i.useEffect)(()=>{let t=w.current;t&&h(void 0,null,function*(){j(!0),A(null);try{l?(t.loadContent(l),j(!1),null==g||g()):o?t.loadUrl(o,()=>{j(!1),A(null),null==g||g()},t=>{console.error("%cIFrameReactContainer: handleError (callback from IFrameContainer) triggered.","color: red;",t),j(!1),A(t),null==y||y(t)}):j(!1)}catch(t){if(console.error(">>> Sync Error during loadContentOrUrl setup:",t),t instanceof Error)j(!1),A(t),null==y||y(t);else{let t=Error("An unknown error occurred during setup");j(!1),A(t),null==y||y(t)}}})},[o,l,y,g,w.current]),(0,r.jsxs)("div",{ref:v,style:e,className:n,children:[b&&(0,r.jsxs)(s.A,{sx:{display:"flex",justifyContent:"center",alignItems:"center",padding:2},children:[(0,r.jsx)(c.A,{size:24}),(0,r.jsx)(d.A,{variant:"body2",sx:{ml:1},children:"Loading preview..."})]}),k&&!b&&(0,r.jsxs)(u.A,{severity:"error",sx:{m:1},children:["Preview Error: ",k.message]})]})}}},t=>{var e=e=>t(t.s=e);t.O(0,[162,602,852,426,455,140,889,106,784,517,636,593,792],()=>e(93896)),_N_E=t.O()}]);