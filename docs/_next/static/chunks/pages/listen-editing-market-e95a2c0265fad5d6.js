(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[347],{4708:(e,t,n)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/listen-editing-market",function(){return n(80591)}])},80591:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>C});var r=n(50612),o=n(75936),a=n(73256),c=n(25065),l=n(68053),s=n(5016),i=n(95294),d=n(26950),u=n(77257),p=n(39690),m=n(92767),f=n(38543),h=n(12066),x=n(1990),y=n(65820),g=n(71108),j=n(76806),k=n(44472),v=n(13124),w=n(94344);let b=e=>{let{file:t}=e,[n,o]=(0,w.useState)(!1);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(u.Ay,{sx:{pl:4,display:"flex",alignItems:"center"},children:[(0,r.jsx)(s.A,{sx:{mr:1,fontSize:"1rem",flexShrink:0}}),(0,r.jsx)(p.A,{primary:t.path,secondary:"Type: ".concat(t.type),primaryTypographyProps:{variant:"body2",noWrap:!0,flexGrow:1,mr:1},secondaryTypographyProps:{variant:"caption"}}),(0,r.jsx)(m.A,{label:n?"Hide Content":"Show Content",size:"small",onClick:()=>o(!n),disabled:!t.content})]}),(0,r.jsx)(f.A,{in:n,timeout:"auto",unmountOnExit:!0,children:(0,r.jsx)(h.A,{sx:{pl:6,pr:2,pb:1},children:(0,r.jsx)(x.A,{elevation:1,sx:{p:1,maxHeight:"150px",overflowY:"auto",background:"#f5f5f5"},children:(0,r.jsx)(y.A,{component:"pre",variant:"caption",sx:{whiteSpace:"pre-wrap",wordBreak:"break-all"},children:t.content||"(Content not loaded or empty)"})})})})]})},A=e=>{let{market:t}=e,[n,o]=(0,w.useState)(!0);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(u.Ay,{button:!0,onClick:()=>{o(!n)},children:[(0,r.jsx)(p.A,{primary:t.name,primaryTypographyProps:{fontWeight:"bold"}}),t.files?n?(0,r.jsx)(i.A,{}):(0,r.jsx)(d.A,{}):null]}),t.files&&(0,r.jsx)(f.A,{in:n,timeout:"auto",unmountOnExit:!0,children:(0,r.jsx)(g.A,{component:"div",disablePadding:!0,children:t.files.length>0?t.files.map((e,n)=>(0,r.jsx)(b,{file:e},"".concat(t.name,"-file-").concat(n,"-").concat(e.path))):(0,r.jsx)(u.Ay,{sx:{pl:4},children:(0,r.jsx)(p.A,{primary:"(Waiting for file data...)",primaryTypographyProps:{fontStyle:"italic",variant:"body2"}})})})})]})},S=e=>{let{marketList:t,isLoading:n}=e;return n?(0,r.jsx)(h.A,{sx:{display:"flex",justifyContent:"center",my:3},children:(0,r.jsx)(j.A,{})}):t&&0!==t.length?(0,r.jsx)(x.A,{elevation:2,sx:{mt:2},children:(0,r.jsx)(g.A,{component:"nav","aria-labelledby":"nested-list-subheader",children:t.map(e=>(0,r.jsx)(A,{market:e},e.name))})}):(0,r.jsx)(y.A,{sx:{mt:2,fontStyle:"italic"},children:"No markets configured or found."})},P="listen-editing-market";function E(){let[e,t]=(0,w.useState)("ws://localhost:8080"),[n,o]=(0,w.useState)([]),[a,c]=(0,w.useState)(!1),[s,i]=(0,w.useState)(!0),d=(0,w.useRef)(null),u=(0,w.useRef)([]);return(0,w.useEffect)(()=>{i(!0);let e=l.P.namespace(P).read("marketData");if(e){var n;console.log("[".concat(P,"] Fetched initial config:"),e),t(e.socketAddr||"ws://localhost:8080"),u.current=(null===(n=e.marketList)||void 0===n?void 0:n.map(e=>e.name))||[],o(u.current.map(e=>({name:e,files:[]})))}else console.warn("[".concat(P,"] No initial config found in store2.")),o([]),u.current=[];i(!1)},[]),(0,w.useEffect)(()=>{if(!e){console.log("[".concat(P,"] No socket address.")),c(!1);return}return d.current&&d.current.close(),console.log("[".concat(P,"] Attempting to connect: ").concat(e)),d.current=new WebSocket(e),c(!1),d.current.onopen=()=>{var e;if(console.log("[".concat(P,"] WebSocket connected.")),c(!0),(null===(e=d.current)||void 0===e?void 0:e.readyState)===WebSocket.OPEN){console.log("[".concat(P,"] Requesting all market data from server."));let e=JSON.stringify({action:"getAllMarkets"});d.current.send(e)}else console.warn("[".concat(P,"] WebSocket not open when trying to send getAllMarkets request."))},d.current.onmessage=e=>{try{let t=JSON.parse(e.data.toString());console.log("[".concat(P,"] Received:"),t.type,t.marketName||""),o(e=>{let n=structuredClone(e);if("allMarketData"===t.type&&Array.isArray(t.markets))console.log("[".concat(P,"] Received all market data. Replacing local list.")),n=t.markets.map(e=>{var t;return{name:e.name,files:(null===(t=e.files)||void 0===t?void 0:t.map(e=>({...e,content:e.content||""})))||[],html:e.html}});else if("marketData"===t.type&&t.marketName){var r,o;let e=n.findIndex(e=>e.name===t.marketName);-1!==e?(n[e].files=(null===(r=t.files)||void 0===r?void 0:r.map(e=>({...e,content:e.content||""})))||[],n[e].html=t.html):(console.log("[".concat(P,"] Received marketData for a new market: ").concat(t.marketName,". Adding to list.")),n.push({name:t.marketName,files:(null===(o=t.files)||void 0===o?void 0:o.map(e=>({...e,content:e.content||""})))||[],html:t.html}))}else if("fileUpdate"===t.type&&t.marketName&&t.path){let e=n.findIndex(e=>e.name===t.marketName);if(-1!==e){let r=n[e].files.findIndex(e=>e.path===t.path);-1!==r?(n[e].files[r].content=t.content||"",n[e].files[r].type=t.fileType):console.warn("[".concat(P,"] FileUpdate for unknown file: ").concat(t.marketName,"/").concat(t.path))}else console.warn("[".concat(P,"] FileUpdate for unknown market: ").concat(t.marketName))}else"error"===t.type?console.error("[".concat(P,"] Server error:"),t.message):console.log("[".concat(P,"] Unhandled message type:"),t.type);return n})}catch(t){console.error("[".concat(P,"] Error processing message:"),t,e.data)}},d.current.onerror=e=>{console.error("[".concat(P,"] WebSocket error:"),e),c(!1)},d.current.onclose=e=>{console.log("[".concat(P,"] WebSocket disconnected. Code: ").concat(e.code,", Reason: ").concat(e.reason)),c(!1)},()=>{d.current&&(console.log("[".concat(P,"] Closing WebSocket on unmount.")),d.current.onopen=null,d.current.onmessage=null,d.current.onerror=null,d.current.onclose=null,d.current.close(),d.current=null)}},[e]),(0,r.jsxs)(k.A,{maxWidth:"md",sx:{py:3},children:[(0,r.jsx)(y.A,{variant:"h5",gutterBottom:!0,component:"div",children:"Market Watcher Status"}),(0,r.jsxs)(h.A,{sx:{display:"flex",alignItems:"center",mb:2},children:[(0,r.jsx)(m.A,{label:a?"Connected":e?"Connecting...":"Disconnected",color:a?"success":e?"warning":"error",size:"small",sx:{mr:2}}),(0,r.jsx)(y.A,{variant:"body2",color:"textSecondary",children:e||"No address configured"})]}),(0,r.jsx)(v.A,{sx:{mb:2}}),(0,r.jsx)(y.A,{variant:"h6",gutterBottom:!0,component:"div",children:"Watched Markets"}),(0,r.jsx)(S,{marketList:n,isLoading:s&&0===n.length})]})}function C(){let e=new c.m;return(0,w.useEffect)(()=>{let e=new WebSocket("ws://localhost:8080");e.onopen=()=>{console.log("Connected to the WebSocket server")},e.onmessage=e=>{let t=JSON.parse(e.data);"file-changed"===t.type&&console.log("File changed: ".concat(t.file))},e.onerror=e=>{console.error("WebSocket error:",e)},e.onclose=()=>{console.log("WebSocket connection closed")}},[]),(0,r.jsx)(o.G,{children:(0,r.jsx)(a.W,{appbarProps:{title:"edit",back:!0,backDispatcher:e},children:(0,r.jsx)(E,{})})})}},75936:(e,t,n)=>{"use strict";n.d(t,{G:()=>p});var r=n(50612),o=n(40242),a=n(68053),c=n(23026),l=n(42590),s=n(57555),i=n(53757),d=n(94344),u=n(26954);function p(e){let{children:t}=e,n=(0,i.useRouter)(),p="scrollPositionInfo",m=window.location.href.split("#")[0],f="dynamic-".concat(m),h=a.P.namespace(f),x=h.read(f);return x||(x={}),x=(0,c.I$)(x),(0,d.useEffect)(()=>{n.beforePopState(e=>(h.clearAll(),!0))}),(0,d.useEffect)(()=>(h.write(f,x),(0,l.c)(x,()=>{h.write(f,x)})),[]),(0,d.useEffect)(()=>{let e=h.read(p)||{x:0,y:0};function t(e){h.write(p,{x:window.scrollX,y:window.scrollY})}function n(){window.addEventListener("scroll",t)}return 0==e.x&&0==e.y?n():window.requestAnimationFrame(()=>{window.scrollTo(e.x,e.y),n()}),function(){window.removeEventListener("scroll",t)}}),(0,r.jsx)(s.q,{value:h,children:(0,r.jsx)(s.p,{value:x,children:(0,r.jsx)(u.xC,{i18n:o.i18n,children:t})})})}(0,o.i18nInit)()},73256:(e,t,n)=>{"use strict";n.d(t,{W:()=>q});var r=n(50612),o=n(35011),a=n(80686),c=n(9655),l=n(67779),s=n(16425),i=n(23235),d=n(92776),u=n(64909),p=n(61150),m=n(88778),f=n(62754),h=n(28542),x=n(94344),y=n(53757),g=n(25065),j=(e,t,n)=>new Promise((r,o)=>{var a=e=>{try{l(n.next(e))}catch(e){o(e)}},c=e=>{try{l(n.throw(e))}catch(e){o(e)}},l=e=>e.done?r(e.value):Promise.resolve(e.value).then(a,c);l((n=n.apply(e,t)).next())});let k=new g.m,v={dipsatcher:k,screenLockCount:0,switchPage:()=>j(void 0,null,function*(){k.dispatch("switchPage"),v.screenLockCount=0}),listenSwitchPage:e=>k.addListener("switchPage",e)};var w=n(76838),b=n(2196);function A(e){let{children:t}=e,n=(0,y.useRouter)();return(0,r.jsx)(w.N,{mode:"wait",children:(0,r.jsx)(b.P.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},transition:{duration:.3},children:t},n.route)})}let S=0;function P(e){let{children:t}=e,n="app-shell-".concat(S++);return(0,x.useEffect)(()=>{let e=document.querySelector("#".concat(n)),t=v.listenSwitchPage(()=>{if(!e)return});if(e)return e.addEventListener("click",e=>{0!=v.screenLockCount&&(e.stopPropagation(),e.preventDefault())}),()=>{t()}},[]),(0,r.jsx)(l.A,{id:n,children:(0,r.jsx)(A,{children:t})})}var E=n(22726),C=Object.defineProperty,N=Object.defineProperties,W=Object.getOwnPropertyDescriptors,O=Object.getOwnPropertySymbols,D=Object.prototype.hasOwnProperty,L=Object.prototype.propertyIsEnumerable,T=(e,t,n)=>t in e?C(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,_=(e,t)=>{for(var n in t||(t={}))D.call(t,n)&&T(e,n,t[n]);if(O)for(var n of O(t))L.call(t,n)&&T(e,n,t[n]);return e},I=(e,t)=>N(e,W(t));function R(e){let{children:t,window:n}=e,c=(0,o.A)({target:n?n():void 0});return(0,r.jsx)(a.A,{appear:!1,direction:"down",in:!c,children:null!=t?t:(0,r.jsx)("div",{})})}function F(e){let{children:t,window:n}=e,a=(0,o.A)({target:n?n():void 0,disableHysteresis:!0,threshold:100});return(0,r.jsx)(c.A,{in:a,children:(0,r.jsx)(l.A,{"data-id":"content-scroll-top-button",onClick:e=>{let t=(e.target.ownerDocument||document).querySelector("#back-to-top-anchor");t&&t.scrollIntoView({block:"center"})},role:"presentation",sx:{position:"fixed",bottom:16,right:16},children:t})})}function q(e){let{children:t,appbarProps:n,titleConf:o}=e,a=(0,y.useRouter)();return(0,r.jsx)(P,{children:(0,r.jsxs)(x.Fragment,{children:[(0,r.jsx)(s.Ay,{}),(0,r.jsx)(R,I(_({},e),{children:(0,r.jsx)(i.A,{color:"inherit",children:(0,r.jsxs)(d.A,{children:[(0,r.jsx)(f.A,{onClick:function(){if(!m.W.askHistoryBack().defaultPrevented){if(n.backDispatcher){let e={defaultPrevented:!1};if(n.backDispatcher.dispatch("back",e),e.defaultPrevented)return}a.back()}}}),n.title]})})})),(0,r.jsx)(d.A,{id:"back-to-top-anchor"}),(0,r.jsx)(u.A,{sx:{padding:"0",marginTop:"17px"},children:(0,r.jsx)(E.A,{titleConf:o,children:t})}),(0,r.jsx)(F,I(_({},e),{children:(0,r.jsx)(p.A,{size:"small","aria-label":"scroll back to top",children:(0,r.jsx)(h.A,{})})}))]})})}},22726:(e,t,n)=>{"use strict";n.d(t,{A:()=>h});var r=n(50612),o=n(67779),a=n(85364),c=n(64909),l=n(94344),s=n(77570),i=n(40242),d=(e,t,n)=>new Promise((r,o)=>{var a=e=>{try{l(n.next(e))}catch(e){o(e)}},c=e=>{try{l(n.throw(e))}catch(e){o(e)}},l=e=>e.done?r(e.value):Promise.resolve(e.value).then(a,c);l((n=n.apply(e,t)).next())});function u(){return s.Cu?(0,r.jsxs)(o.A,{children:[(0,r.jsx)(a.A,{onClick:()=>{window.location.reload()},children:"reload"}),new Date().toLocaleString()]}):(0,r.jsx)(r.Fragment,{children:"  "})}let p=(0,l.createContext)({x:0,y:0}),m=0;function f(e){let{children:t,titleConf:n}=e;m++;let a=(0,l.useContext)(p),s="".concat(Date.now()+Math.random()*Date.now());return(0,l.useEffect)(()=>{!function(){d(this,null,function*(){if(!n)return;let e=n.title;n.ns&&(e=yield(0,i.loadI18nValue)(n.ns,n.key||"content.title")),e&&(document.title=e)})}()},[]),(0,l.useEffect)(()=>{let e=document.getElementsByClassName(s)[0];if(!e)return;e.scrollTop=a.y;let t=()=>{var t=e.scrollTop;a.y=t};return e.removeEventListener("scroll",t),e.addEventListener("scroll",t,{passive:!0}),()=>e.removeEventListener("scroll",t)},[s,a]),(0,r.jsx)(c.A,{className:s,sx:{flexGrow:1,overflow:"auto",padding:"0px"},children:(0,r.jsxs)(o.A,{children:[(0,r.jsx)(u,{}),t]})})}function h(e){let{children:t,titleConf:n}=e;return(0,r.jsx)(f,{titleConf:n,children:t})}}},e=>{var t=t=>e(e.s=t);e.O(0,[162,602,852,455,257,461,286,636,593,792],()=>t(4708)),_N_E=e.O()}]);